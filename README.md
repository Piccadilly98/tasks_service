# tasks_service
# Tasks_Service - сервис для управления задачами пользователй(упрощенный аналог Jira) с использованием микросервисной архитектуры

[💻Информация для разработчиков](#для-разработчиков)  
[📝Информация для заказчика](./docs/Документация%20для%20заказчика.docx)


# Для разработчиков
[📜Техническое задание](./docs/TOR.docx)  
[📟Стек технологий](#стек-технологий)   
[📄Технические требования](#технические-требования-в-соответствии-с-тех-заданием)  
### [🏗️Архитектура сервиса](#архитектура-сервиса)   
- [Слои микросервисов](#слои-микросервисов)
- [Схемы движения данных](#схемы-движения-данных)


## Стек технологий
- **Docker** - для деплоя
- **Язык программирования**: Go (совместимая с 1.25+)
- **HTTP**: Стандартная библиотека `Go`
- **Хранение данных**: In-memory с конкурентной безопасностью с помощью пакета `sync`
- **Аутентификация базовая**: API токены**
- **Аутентификация оптимальная**: JWT токены**
- **Формат данных**: JSON
- **Взаимодействие**: HTTP/REST API (возможен переход на gRPC)
- **Фреймворки**: Не используем, дальнейший переход на `Fiber`   
- **Конфигурация**: С помощью `.env` файла в корне репозитория

**-для сокращения времени до `MVP` есть возможность использовать API токены
## Технические требования в соответствии с [тех. заданием:](./docs/TOR.docx)  
- Сервис состоит из двух независимых микросервисов:
    - **Auth Service** - сервис для регистрации, авторизации, аунтификации пользователей и управления токенами:
        - Не содержит бизнес правил
        - Валидирует токены для других сервисов
        - Содержит следующие эндпоинты:
            - POST /register - регистрация пользователя
            - POST /login - аутентификация и получение токена
            - POST /validate - валидация токена (внутренний эндпоинт)
    - **Task Service** - сервис для управления задачами пользователей, со всей бизнес логикой и правилами, интеграцией с **Auth Service**:  
        - Содержит следующие бизнес правила:
            - пользователь видит только свои задачи
            - нельзя удалить задачу со статусом done
            - нельзя перевести задачу из done в in_progress
            - название задачи не может быть пустым
        - Проверка доступа к ресурсам с помощью **Auth Service**
        - Содержит следующие эндпоинты:
            - POST /tasks - создание задачи
            - GET /tasks - получение списка задач
            - PUT /tasks/{id} - обновление задачи
            - DELETE /tasks/{id} - удаление задачи
        - В сервис попадают только запросы содержащие заголовок **Authorization: Bearer <token>** и прошедшие валдидацию с помощью **Auth Service**
- Микросервисы общаются между собой с помощью HTTP (JSON), с дальнейшим переходом на GRPC
- **Ограничения**:
    - Использование только in-memory хранилище
    - Отсутсвие фреймворков, в дальнейшем переход на Fiber
    - Использование только стандартной библиотеки Go
    - Максимальная фокусировка на архитектуру, обработку ошибок и читаемость кода

## Архитектура сервиса
За основной референс для построения архитектуры лучше использовать стратегию `Monorepo`, которая предпологает расположение всех микросервисов и модулей в рамках одного git репозитория, что позволяет более удобно участвовать в разработке двух микросервисов + упрощает деплой с помощью Docker.  

Примерная структура:
```ascii
├── Makefile       #общий makefile 
├── README.md
├── common         #общие части для микросервисов
│   ├── internal   #не экспортируемые пакеты  
│   └── pkg        #экспортированные пакеты
├── docs           #документация по проекту
│   ├── TOR.docx
│   └── Документация для заказчика.docx
└── services           #директория микросервисов
    ├── auth_service
    │   ├── Makefile   #локальный makefile для сборки
    │   ├── cmd        #точка входа в программу(запуск сервиса)
    │   │   └── main
    │   │       └── main.go
    │   ├── go.mod
    │   ├── internal   
    │   │   ├── domain      #бизнес сущности
    │   │   ├── repository  #реализация репозиториев(кэш, бд)
    │   │   │   └── interfaces.go   #интерфейсы для мокирования
    │   │   ├── service             #сервис слой
    │   │   └── transport           #слой транспорта(http, grpc)
    │   │       ├── grpc
    │   │       └── http
    │   │           ├── dto         #dto для http запросов
    │   │           └── handlers    #тонкие обработчики
    │   └── tests
    │   
    └── tasks_service
        ├── Makefile
        ├── cmd
        │   └── main
        │       └── main.go
        ├── go.mod
        ├── internal
        │   ├── domain
        │   ├── repository
        │   │   └── interfaces.go
        │   ├── service
        │   └── transport
        │       ├── grpc
        │       └── http
        │           ├── dto
        │           └── handlers
        └── tests
```

### Слои микросервисов
Микросервисы будут иметь 3 основных слоя:
| Слой|Описание|Задачи|
| ---|---|---|
|Верхний слой - слой `transport`.|Слой представляющий из себя тонкие http/grpc обработчики.|Отвечает за: проверку `headers` запросов, получение данных, проверку формата, синтаксиса, анмаршалинг, валидацию на уровне dto и дальнейший вызов методов пакета сервиса, для бизнес операций|
|Промежуточный слой - слой `service`|Является прослойкой между верхним уровнем `transport` и нижним слоем `repository`(прямая работа с данными). Слой принимает объекты `dto`. Слой не работает с данными на прямую, а является прослойкой для бизнес логики.|Отвечает за: получение данных в виде dto от других уровней, бизнес валидацию, бизнес логику,`конвертацию dto в domain сущности`, вызов методов слоя `repository`, получение domain сущностей и обратная конвертация в dto.|
|Нижний слой - слой `repository`|Слой представляет из себя тип данных, который содержит методы по работе с данными в хранилищах(база данных, кэш). `repository` не работает с бизнес правилами и не знает о верхнем слое `service`, он работает только с данными.|Отвечает за: получение `domain сущностей`, безопасный конкурентный доступ к данным, операции над хранилищами(прямая работа с данными), отдача бизнес сущностей.|

### Схемы движения данных
**Общая схема**
```ascii
         ┌────────────┐
         │  Клиент    │
         └─────┬──────┘
               │ JSON-запрос
               ▼
┌─────────────────────────────────────┐
│      TRANSPORT (http)               │
├─────────────────────────────────────┤
│  • Анмаршалинг JSON → DTO           │
│  • Валидация DTO                    │
│  • Вызов Service                    │
└──────────────┬──────────────────────┘
               │ DTO
               ▼
┌─────────────────────────────────────┐
│         SERVICE                     │
├─────────────────────────────────────┤
│  • Бизнес-валидация                 │
│  • Конвертация DTO → Domain         │
│  • Вызов Repository                 │
└──────────────┬──────────────────────┘
               │ Domain
               ▼
┌─────────────────────────────────────┐
│       REPOSITORY                    │
├─────────────────────────────────────┤
│  • CRUD операции                    │
│  • Работа с хранилищами             │
│  • Возврат Domain                   │
└──────────────┬──────────────────────┘
               │ Domain
               ▼
┌─────────────────────────────────────┐
│         SERVICE                     │
├─────────────────────────────────────┤
│  • Получение Domain                 │
│  • Конвертация Domain → DTO         │
│  • Отдача DTO в Transport           │
└──────────────┬──────────────────────┘
               │ DTO
               ▼
┌─────────────────────────────────────┐
│      TRANSPORT (http)               │
├─────────────────────────────────────┤
│  • Маршалинг DTO → JSON             │
│  • Настройка headers                │
│  • Установка status code            │
│  • Отправка ответа                  │
└──────────────┬──────────────────────┘
               │ JSON-ответ
               ▼
         ┌────────────┐
         │  Клиент    │
         └────────────┘
```